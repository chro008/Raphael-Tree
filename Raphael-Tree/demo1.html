<!DOCTYPE html>
<html>
<!-- saved from url=(0014)about:internet -->
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <title>Raphael Test</title>
    <style>
        .label_container {
            position: absolute;
            left: 0;
            top: 0;
        }
    </style>
    <script src="sys.spacetree.js"></script>
</head>
<body>
<div id="my-canvas" style="width:1000px;height:800px;padding:0;margin:0;cursor:auto;position: fixed;overflow: hidden;">
</div>
<script type="text/javascript" src="raphael.min.js"></script>
<script type="text/javascript" src="sys.spacetree.js"></script>
<script type="text/javascript">

    var jsonData = [
        {
            id: "zero",
            data: {name: "root", age: 10, num: 100}
        },
        {
            id: "first-0",
            data: {name: "第一级第0个", age: 10, num: 30},
            parent: "zero"
        },
        {
            id: "first-1",
            data: {name: "第一级第1个", age: 10, num: 20},
            parent: "zero"
        },
        {
            id: "first-2",
            data: {name: "第一级第2个", age: 10, num: 15},
            parent: "zero"
        },
        {
            id: "first-3",
            data: {name: "第一级第3个", age: 10, num: 10},
            parent: "zero"
        },
        {
            id: "first-4",
            data: {name: "第一级第4个", age: 10, num: 5},
            parent: "zero"
        },
        {
            id: "first-5",
            data: {name: "第一级第5个", age: 10, num: 3},
            parent: "zero"
        },
        {
            id: "first-6",
            data: {name: "第一级第6个", age: 10, num: 2},
            parent: "zero"
        },
        {
            id: "first-7",
            data: {name: "第一级第7个", age: 10, num: 1},
            parent: "zero"
        },
        {
            id: "second-0",
            data: {name: "第二级第0个", age: 10, num: 15},
            parent: "first-0"
        },
        {
            id: "second-1",
            data: {name: "第二级第1个", age: 10, num: 8},
            parent: "first-0"
        },
        {
            id: "second-2",
            data: {name: "第二级第2个", age: 10, num: 5},
            parent: "first-0"
        },
        {
            id: "second-3",
            data: {name: "第二级第3个", age: 10, num: 10},
            parent: "first-1"
        },
        {
            id: "second-4",
            data: {name: "第二级第4个", age: 10, num: 5},
            parent: "first-1"
        },
        {
            id: "second-5",
            data: {name: "第二级第5个", age: 10, num: 3},
            parent: "first-2"
        },
        {
            id: "second-6",
            data: {name: "第二级第6个", age: 10, num: 1},
            parent: "first-2"
        },
        {
            id: "third-0",
            data: {name: "第三级第0个", age: 10, num: 1},
            parent: "second-0"
        },
        {
            id: "third-1",
            data: {name: "第三级第1个", age: 10, num: 1},
            parent: "second-0"
        },
        {
            id: "forth-0",
            data: {name: "第4级第0个", age: 10, num: 1},
            parent: "third-0"
        }
    ];

    var st = new window.SpaceTree("my-canvas", {
        animate:true,
        duration:200,
        getNodeRate: function (node, parentNode) {
            var num1 = node.getData().data.num,
                num2 = parentNode.getData().data.num;

            return num1 * 100 / num2;
        },
        getEdgeFillColor: function (thisNode, parentNode) {
            var colors = ["red", "yellow", "blue", "gray", "pink", "green"];
            var retColor = colors[parseInt(Math.random() * 6)];
            console.log(parentNode.getId() + "->" + thisNode.getId(), retColor);
            return retColor;
        },
        getNodeExitProperties: function (node) {
            var props = [
                {width: 20, height: 20, color: "blue", pipe_height: 10},
                {width: 10, height: 18.5, color: "#89B7E8", pipe_height: 4},
                {width: 15, height: 10, color: "red", pipe_height: 7}];
            var retProp = props[parseInt(Math.random() * 3)];
            console.log(node.getId() + "出口属性：", retProp);
            return retProp;
        },
        getNodeColor: function (node, selected, hasChild) {
            if (selected) {
                console.log("node[" + node.getId() + "] is selected,color is:E4393C");
                return "#E4393C";
            } else if (hasChild) {
                console.log("node[" + node.getId() + "] not selected but has children,color is:9AC3FF");
                return "#9AC3FF";
            } else {
                console.log("node[" + node.getId() + "] not selected nor has children,color is:C2CDF8");
                return "#C2CDF8";
            }
        },
        setNodeLabelHtml: function (node, nodeLabel) {
            var nodeid = node.getId();
            var data = node.getData().data.name;
            nodeLabel.innerHTML = "<div style='font-size: 12px;line-height: 20px;height: 20px;width: 100%;'>" +
                "<span style='margin-left: 6px;'>" + nodeid + "：" + data + "</span></div>";
        },
        addNodeLabelEventListener: function (node, nodeLabel) {
            var ismove = false, clickX, clickY;
            nodeLabel.onclick = function () {
                if (ismove) {
                    ismove = false;
                    console.log("拖动事件，不再触发点击事件");
                } else {
                    console.log("刚刚点击了[" + node.getId() + "]");
                    if (node.getId() === "third-1") {
                        st.addLoadData([{
                            id: "forth-1",
                            data: {name: "第4级第2个", age: 10, num: 1},
                            parent: "third-1"
                        }])
                    }
                    st.onclick(node.getId())
                }
            };
            nodeLabel.onmousedown = function (e) {
                var event = e || window.event;
                clickX = event.clientX;
                clickY = event.clientY;
            };
            nodeLabel.onmouseup = function (e) {
                var event = e || window.event;
                if (clickX !== event.clientX || clickY !== event.clientY) {
                    ismove = true;
                }
            };
        },
    });

    //st.loadData(jsonData).draw();
    st.draw(jsonData);

</script>
</body>
</html>  